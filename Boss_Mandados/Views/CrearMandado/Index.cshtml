@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="@Url.Content("~/Styles/select2.min.css")" rel="stylesheet" />
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Nuevo Mandado</h2>
    </div>
</div>

<div class="row">
    <div class="col-md-5">
        <div class="wrapper-content">
            <div class="ibox-content form-horizontal">
                <h2>Agregar Ruta</h2>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Dirección</label>
                    <div class="col-sm-9"><input id="direccion" type="text" class="form-control"></div>
                </div>
                <input type="hidden" id="latitud" value="">
                <input type="hidden" id="longitud" value="">
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Calle</label>
                    <div class="col-sm-9"><input id="calle" type="text" class="form-control"></div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Número</label>
                    <div class="col-sm-9"><input id="numero" type="number" min="0" step="1" class="form-control"></div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <div class="col-sm-12">
                        <select class="form-control m-b" id="servicio">
                            <option value="">Selecciona el servicio</option>
                            @foreach (var item in ViewBag.servicios)
                            {
                                <option value="@item.id">@item.nombre</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Comentarios</label>
                    <div class="col-sm-9"><textarea id="textarea" class="comentarios"></textarea></div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <div class="col-sm-4 col-sm-offset-2">
                        <button class="btn btn-primary" id="agregar_ruta" type="submit">Agregar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-7">
        <div class="wrapper-content">
            <div class="ibox-content">
                <h2>Rutas del Mandado</h2>
                <div class="table-responsive">
                    <div id="tabla_rutas">
                        <table class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Servicio</th>
                                    <th>Latitud</th>
                                    <th>Longitud</th>
                                    <th>Comentarios</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in ViewBag.rutas)
                                {
                                    <tr>
                                        <td>@item.servicio</td>
                                        <td>@item.latitud</td>
                                        <td>@item.longitud</td>
                                        <td>@item.comentarios</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-6">
                <div class="wrapper-content">
                    <div class="ibox-content form-horizontal">
                        <h2>Nuevo Cliente</h2>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Nombre</label>
                            <div class="col-sm-9"><input id="nombre" type="text" class="form-control"></div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Correo</label>
                            <div class="col-sm-9"><input id="correo" type="text" class="form-control"></div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Teléfono</label>
                            <div class="col-sm-9"><input id="telefono" type="text" class="form-control"></div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <div class="col-sm-12">
                                <select class="form-control m-b mandadero_nuevo" id="mandadero_nuevo">
                                    <option value="0">Selecciona el mandadero</option>
                                    @foreach (var item in ViewBag.mandaderos)
                                    {
                                        <option value="@item.id">@item.nombre</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <div class="col-sm-4 col-sm-offset-2">
                                <button class="btn btn-primary" id="crear_mandado_nuevo" type="submit">Crear</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="wrapper-content">
                    <div class="ibox-content form-horizontal">
                        <h2>Cliente Existente</h2>
                        <div class="form-group">
                            <div class="col-sm-12">
                                <select class="form-control m-b" id="cliente">
                                    <option value="">Selecciona el cliente</option>
                                    @foreach (var item in ViewBag.clientes)
                                    {
                                        <option value="@item.id">@item.nombre</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <div class="col-sm-12">
                                <select class="form-control m-b mandadero_existente" id="mandadero_existente">
                                    <option value="0">Selecciona el mandadero</option>
                                    @foreach (var item in ViewBag.mandaderos)
                                    {
                                        <option value="@item.id">@item.nombre</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="hr-line-dashed"></div>
                        <div class="form-group">
                            <div class="col-sm-4 col-sm-offset-2">
                                <button class="btn btn-primary" id="crear_mandado_existente" type="submit">Crear</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    $(document).ready(function () {
        $('#cliente').select2();
        $('.mandadero_nuevo').select2();
        $('.mandadero_existente').select2();
    });
    $('#agregar_ruta').click(function () {
        var calle = $('#calle').val();
        var numero = $('#numero').val();
        var servicio = $('#servicio').val();
        var latitud = $('#latitud').val();
        var longitud = $('#longitud').val();
        var comentarios = $('.comentarios').val();

        $.ajax({
            url: window.location.pathname + '/Agregar_Ruta',
            data: { 'calle': calle, 'numero': numero, 'servicio': servicio, 'latitud': latitud, 'longitud': longitud, 'comentarios': comentarios },
            type: "post",
            cache: false,
            success: function (mensaje) {
                //console.log(mensaje);
                $("#tabla_rutas").load(window.location + " #tabla_rutas");
                clearInputAgregarRuta();
            },
            error: function (xhr, ajaxOptions, thrownError) {
                //console.log(thrownError);
            }
        });
    });
    $('#crear_mandado_nuevo').click(function () {
        var nombre = $('#nombre').val();
        var correo = $('#correo').val();
        var telefono = $('#telefono').val();
        var mandadero = $('#mandadero_nuevo option:selected').val();

        $.ajax({
            url: window.location.pathname + '/Agregar_Mandado_Nuevo',
            data: { 'nombre': nombre, 'correo': correo, 'telefono': telefono, 'mandadero': mandadero },
            type: "post",
            cache: false,
            success: function (mensaje) {
                //console.log(mensaje);
                window.location.href = "Mandados";
            },
            error: function (xhr, ajaxOptions, thrownError) {
                //console.log(thrownError);
            }
        });
    });
    $('#crear_mandado_existente').click(function () {
        var cliente = $('#cliente').val();
        var mandadero = $('#mandadero_existente option:selected').val();

        $.ajax({
            url: window.location.pathname + '/Agregar_Mandado_Existente',
            data: { 'cliente': cliente, 'mandadero': mandadero },
            type: "post",
            cache: false,
            success: function (mensaje) {
                //console.log(mensaje);
                window.location.href = "Mandados";
            },
            error: function (xhr, ajaxOptions, thrownError) {
                //console.log(thrownError);
            }
        });
    });
    function clearInputAgregarRuta() {
        $('#calle').val('');
        $('#numero').val('');
        $('#servicio')[0].selectedIndex = 0;
        $('#latitud').val('');
        $('#longitud').val('');
        $('.comentarios').val('');
        $('#direccion').val('');
    }
</script>

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC8nWW1F1b2-oI5KXN1ito-gXtABMMthhA&libraries=places"></script>
<script src="@Url.Content("/Scripts/select2.min.js")"></script>
<script>
    function init() {
        var input = document.getElementById('direccion');
        var autocomplete = new google.maps.places.Autocomplete(input);
        google.maps.event.addListener(autocomplete, 'place_changed', function () {
            var place = autocomplete.getPlace();
            document.getElementById('latitud').value = place.geometry.location.lat();
            document.getElementById('longitud').value = place.geometry.location.lng();
        });
    }
    google.maps.event.addDomListener(window, 'load', init);
</script>