@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-lg-10">
        <h2>Nuevo Mandado</h2>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="wrapper-content">
            <div class="ibox-content form-horizontal">
                <div class="form-group">
                    <label class="col-sm-2 control-label">Dirección</label>
                    <div class="col-sm-10"><input id="direccion" type="text" class="form-control"></div>
                </div>
                <input type="hidden" id="latitud" value="">
                <input type="hidden" id="longitud" value="">
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">Servicio</label>
                    <div class="col-sm-10">
                        <select class="form-control m-b" id="servicio">
                            <option value="">Selecciona el servicio</option>
                            @foreach (var item in ViewBag.servicios)
                            {
                                <option value="@item.id">@item.nombre</option>
                            }
                        </select>
                    </div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">Comentarios</label>
                    <div class="col-sm-10"><textarea id="textarea" class="comentarios"></textarea></div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <div class="col-sm-4 col-sm-offset-2">
                        <button class="btn btn-primary" id="agregar_ruta" type="submit">Agregar</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="wrapper-content">
            <div class="ibox-content">
                <div class="table-responsive">
                    <div id="tabla_rutas">
                        <table class="table table-striped table-bordered table-hover">
                            <thead>
                                <tr>
                                    <th>Servicio</th>
                                    <th>Latitud</th>
                                    <th>Longitud</th>
                                    <th>Comentarios</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var item in ViewBag.rutas)
                                {
                                    <tr>
                                        <td>@item.servicio</td>
                                        <td>@item.latitud</td>
                                        <td>@item.longitud</td>
                                        <td>@item.comentarios</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="wrapper-content">
            <div class="ibox-content form-horizontal">
                <div class="form-group">
                    <label class="col-sm-2 control-label">Nombre</label>
                    <div class="col-sm-10"><input id="nombre" type="text" class="form-control"></div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">Correo</label>
                    <div class="col-sm-10"><input id="correo" type="text" class="form-control"></div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">Teléfono</label>
                    <div class="col-sm-10"><input id="telefono" type="text" class="form-control"></div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <label class="col-sm-2 control-label">Total</label>
                    <div class="col-sm-10"><input id="total" type="number" step="0.01" min="0.00" class="form-control"></div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <div class="col-sm-4 col-sm-offset-2">
                        <button class="btn btn-primary" id="crear_mandado" type="submit">Crear</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    $('#agregar_ruta').click(function () {
        var servicio = $('#servicio').val();
        var latitud = $('#latitud').val();
        var longitud = $('#longitud').val();
        var comentarios = $('.comentarios').val();

        $.ajax({
            url: '/CrearMandado/Agregar_Ruta',
            data: { 'servicio': servicio, 'latitud': latitud, 'longitud': longitud, 'comentarios': comentarios },
            type: "post",
            cache: false,
            success: function (mensaje) {
                console.log(mensaje);
                $("#tabla_rutas").load(window.location + " #tabla_rutas");
            },
            error: function (xhr, ajaxOptions, thrownError) {
                console.log(thrownError);
            }
        });
    });
    $('#crear_mandado').click(function () {
        var nombre = $('#nombre').val();
        var correo = $('#correo').val();
        var telefono = $('#telefono').val();
        var total = $('#total').val();

        $.ajax({
            url: '/CrearMandado/Agregar_Mandado',
            data: { 'nombre': nombre, 'correo': correo, 'telefono': telefono, 'total': total },
            type: "post",
            cache: false,
            success: function (mensaje) {
                console.log(mensaje);
                window.location.href = "Mandados";
            },
            error: function (xhr, ajaxOptions, thrownError) {
                console.log(thrownError);
            }
        });
    });
</script>

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC8nWW1F1b2-oI5KXN1ito-gXtABMMthhA&libraries=places"></script>

<script>
    function init() {
        var input = document.getElementById('direccion');
        var autocomplete = new google.maps.places.Autocomplete(input);
        google.maps.event.addListener(autocomplete, 'place_changed', function () {
            var place = autocomplete.getPlace();
            document.getElementById('latitud').value = place.geometry.location.lat();
            document.getElementById('longitud').value = place.geometry.location.lng();
        });
    }
    google.maps.event.addDomListener(window, 'load', init);
</script>